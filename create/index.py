# coding=utf-8
"""
åˆ›ä½œæ¨¡å—æ ¸å¿ƒåŠŸèƒ½
ç”¨äºåˆ›å»ºå’Œç”Ÿæˆæ–‡æœ¬å†…å®¹
"""

import sys
from pathlib import Path

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°è·¯å¾„
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

from utils.ai_client import get_qwen_client


def generate_content(hot_data: dict, platform: str = "é€šç”¨", content_type: str = "æ–‡ç« ") -> dict:
    """
    åŸºäºçƒ­ç‚¹æ•°æ®ç”Ÿæˆåˆ›ä½œå†…å®¹
    
    Args:
        hot_data: çƒ­ç‚¹æ•°æ®å­—å…¸ï¼ŒåŒ…å«æ ‡é¢˜ã€å†…å®¹ã€å…³é”®è¯ç­‰
        platform: ç›®æ ‡å¹³å°åç§°
        content_type: å†…å®¹ç±»å‹ï¼ˆæ–‡ç« ã€å¾®åšã€çŸ­è§†é¢‘è„šæœ¬ç­‰ï¼‰
        
    Returns:
        åŒ…å«ç”Ÿæˆå†…å®¹çš„å­—å…¸
    """
    client = get_qwen_client()
    
    # æ„å»ºç”¨æˆ·è¾“å…¥
    user_input = f"""
ç›®æ ‡å¹³å°ï¼š{platform}
å†…å®¹ç±»å‹ï¼š{content_type}

çƒ­ç‚¹æ•°æ®ï¼š
æ ‡é¢˜ï¼š{hot_data.get('title', '')}
å†…å®¹ï¼š{hot_data.get('content', '')}
å…³é”®è¯ï¼š{', '.join(hot_data.get('keywords', []))}
"""
    
    # ä½¿ç”¨å…¨å±€æç¤ºè¯å’Œä¸»æµç¨‹æç¤ºè¯
    system_prompt_path = project_root / "create" / "global_prompt.txt"
    main_prompt_path = project_root / "create" / "main" / "main_prompt.txt"
    
    system_prompt = ""
    if system_prompt_path.exists():
        with open(system_prompt_path, 'r', encoding='utf-8') as f:
            system_prompt += f.read() + "\n\n"
    
    if main_prompt_path.exists():
        with open(main_prompt_path, 'r', encoding='utf-8') as f:
            system_prompt += f.read()
    
    # è°ƒç”¨åƒé—®ç”Ÿæˆå†…å®¹
    result = client.generate(
        prompt=user_input,
        system_prompt=system_prompt,
        temperature=0.7,
        max_tokens=2000
    )
    
    return result


def generate_article_by_topic(
    topic: str,
    requirements: str = "",
    platform: str = "é€šç”¨",
    content_type: str = "æŠ€æœ¯æ–‡ç« ",
    word_count: int = 2000,
    style: str = "ä¸“ä¸š"
) -> dict:
    """
    æ ¹æ®ä¸»é¢˜ç›´æ¥ç”Ÿæˆæ–‡ç« 
    
    Args:
        topic: æ–‡ç« ä¸»é¢˜/æ ‡é¢˜
        requirements: å…·ä½“è¦æ±‚å’Œéœ€æ±‚ï¼ˆå¯é€‰ï¼‰
        platform: ç›®æ ‡å¹³å°åç§°
        content_type: å†…å®¹ç±»å‹ï¼ˆæŠ€æœ¯æ–‡ç« ã€åšå®¢æ–‡ç« ã€æ•™ç¨‹ç­‰ï¼‰
        word_count: ç›®æ ‡å­—æ•°
        style: æ–‡ç« é£æ ¼ï¼ˆä¸“ä¸šã€é€šä¿—ã€å­¦æœ¯ç­‰ï¼‰
        
    Returns:
        åŒ…å«ç”Ÿæˆå†…å®¹çš„å­—å…¸
    """
    client = get_qwen_client()
    
    if not client.enable:
        return {
            'success': False,
            'content': '',
            'error': 'åƒé—®æ¨¡å‹æœªå¯ç”¨æˆ–API Keyæœªé…ç½®',
            'usage': {}
        }
    
    # æ„å»ºç”¨æˆ·è¾“å…¥
<<<<<<< HEAD
    # å¦‚æœæœ‰ requirementsï¼ˆdescï¼‰ï¼Œéœ€è¦æ˜ç¡®å¼ºè°ƒè¦æ®æ­¤ç»„ç»‡å†…å®¹
    requirements_text = ""
    if requirements:
        requirements_text = f"""
**é‡è¦ï¼šå…·ä½“è¦æ±‚æè¿°ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰**ï¼š
{requirements}

è¯·åŠ¡å¿…æ ¹æ®ä»¥ä¸Šå…·ä½“è¦æ±‚æè¿°æ¥ç»„ç»‡æ–‡ç« çš„ç»“æ„å’Œå†…å®¹ã€‚è¿™äº›è¦æ±‚æ˜¯æ–‡ç« çš„æ ¸å¿ƒæŒ‡å¯¼ï¼Œéœ€è¦è´¯ç©¿å…¨æ–‡ã€‚
"""
    
    user_input = f"""
è¯·å†™ä¸€ç¯‡å…³äºä»¥ä¸‹ä¸»é¢˜çš„æ–‡ç« ï¼š

**ä¸»é¢˜**ï¼š{topic}
{requirements_text}
**åŸºæœ¬è¦æ±‚**ï¼š
1. æ–‡ç« ç±»å‹ï¼š{content_type}
2. ç›®æ ‡å­—æ•°ï¼šçº¦{word_count}å­—
3. æ–‡ç« é£æ ¼ï¼š{style}ï¼ˆä½†å¿…é¡»åŒ…å«è½»æ¾çš„å£è¯­åŒ–è¡¨è¾¾ï¼‰
4. ç›®æ ‡å¹³å°ï¼š{platform}

**ç‰¹åˆ«å¼ºè°ƒ**ï¼š
- æ–‡ç« å¿…é¡»åŒ…å«è½»æ¾ã€å£è¯­åŒ–çš„è¡¨è¾¾æ–¹å¼ï¼Œè®©è¯»è€…æ„Ÿè§‰åƒåœ¨å’Œæœ‹å‹èŠå¤©
- ä½¿ç”¨"ä½ "ã€"æˆ‘ä»¬"ã€"å…¶å®"ã€"è¯´ç™½äº†"ã€"ä¸¾ä¸ªä¾‹å­"ç­‰å£è¯­åŒ–è¯æ±‡
- åœ¨ä¸“ä¸šå†…å®¹ä¹‹é—´ç©¿æ’è½»æ¾çš„è¡¨è¾¾ï¼Œé¿å…è¿‡äºä¸¥è‚ƒå’Œå­¦æœ¯åŒ–
- å¦‚æœæä¾›äº†å…·ä½“è¦æ±‚æè¿°ï¼Œå¿…é¡»ä¸¥æ ¼æŒ‰ç…§æè¿°æ¥ç»„ç»‡æ–‡ç« ç»“æ„å’Œå†…å®¹

è¯·ç”Ÿæˆä¸€ç¯‡ç»“æ„å®Œæ•´ã€å†…å®¹è¯¦å®ã€é€»è¾‘æ¸…æ™°ï¼ŒåŒæ—¶å…·æœ‰è½»æ¾å£è¯­åŒ–é£æ ¼çš„æ–‡ç« ã€‚
=======
    user_input = f"""
è¯·å†™ä¸€ç¯‡å…³äºä»¥ä¸‹ä¸»é¢˜çš„æ–‡ç« ï¼š

ä¸»é¢˜ï¼š{topic}
{f'å…·ä½“è¦æ±‚ï¼š{requirements}' if requirements else ''}

è¦æ±‚ï¼š
1. æ–‡ç« ç±»å‹ï¼š{content_type}
2. ç›®æ ‡å­—æ•°ï¼šçº¦{word_count}å­—
3. æ–‡ç« é£æ ¼ï¼š{style}
4. ç›®æ ‡å¹³å°ï¼š{platform}

è¯·ç”Ÿæˆä¸€ç¯‡ç»“æ„å®Œæ•´ã€å†…å®¹è¯¦å®ã€é€»è¾‘æ¸…æ™°çš„æ–‡ç« ã€‚
>>>>>>> a21bf6770ed50ce1a0509f94c3a11bf91d2ff8f9
"""
    
    # ä½¿ç”¨å…¨å±€æç¤ºè¯å’Œä¸»æµç¨‹æç¤ºè¯
    system_prompt_path = project_root / "create" / "global_prompt.txt"
    main_prompt_path = project_root / "create" / "main" / "main_prompt.txt"
    
    system_prompt = ""
    if system_prompt_path.exists():
        with open(system_prompt_path, 'r', encoding='utf-8') as f:
            system_prompt += f.read() + "\n\n"
    
    if main_prompt_path.exists():
        with open(main_prompt_path, 'r', encoding='utf-8') as f:
            system_prompt += f.read() + "\n\n"
    
    # æ·»åŠ æ–‡ç« ç”Ÿæˆçš„ç‰¹æ®Šè¦æ±‚ï¼Œç‰¹åˆ«å¼ºè°ƒç”ŸåŠ¨æ€§
    system_prompt += f"""
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å†…å®¹åˆ›ä½œè€…ï¼Œæ“…é•¿æ’°å†™{content_type}ã€‚
è¯·æ ¹æ®ç”¨æˆ·æä¾›çš„ä¸»é¢˜å’Œè¦æ±‚ï¼Œç”Ÿæˆä¸€ç¯‡é«˜è´¨é‡çš„æ–‡ç« ã€‚

æ–‡ç« è¦æ±‚ï¼š
1. ç»“æ„æ¸…æ™°ï¼šåŒ…å«å¼•è¨€ã€æ­£æ–‡ã€ç»“è®ºç­‰éƒ¨åˆ†
2. å†…å®¹è¯¦å®ï¼šæ·±å…¥åˆ†æä¸»é¢˜ï¼Œæä¾›æœ‰ä»·å€¼çš„ä¿¡æ¯
3. é€»è¾‘æ¸…æ™°ï¼šæ¡ç†åˆ†æ˜ï¼Œè®ºè¯å……åˆ†
4. é£æ ¼é€‚é…ï¼šç¬¦åˆ{style}é£æ ¼å’Œ{platform}å¹³å°è§„èŒƒ
5. å­—æ•°æ§åˆ¶ï¼šç›®æ ‡å­—æ•°çº¦{word_count}å­—

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ **æå…¶é‡è¦ï¼šç”ŸåŠ¨æ€§ã€å¯è¯»æ€§å’Œè¶£å‘³æ€§è¦æ±‚ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰** âš ï¸
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ä¸ºäº†è®©æ–‡ç« æ›´æ˜“è¯»ï¼Œç‰¹åˆ«æ˜¯è®©å°ç™½ä¹Ÿèƒ½è½»æ¾çœ‹å®Œï¼Œè¯·åŠ¡å¿…ä¸¥æ ¼éµå®ˆä»¥ä¸‹è¦æ±‚ï¼š

1. **æ¯éš”2-3ä¸ªæ®µè½å¿…é¡»æ’å…¥ç”ŸåŠ¨å…ƒç´ **ï¼ˆè¿™æ˜¯ç¡¬æ€§è¦æ±‚ï¼ï¼‰ï¼š
   - æœ‰è¶£çš„ä¸¾ä¾‹ï¼ˆç”¨ç”Ÿæ´»ä¸­çš„ä¾‹å­è§£é‡ŠæŠ€æœ¯æ¦‚å¿µï¼‰
   - å¹½é»˜çš„æ¯”å–»å’Œç±»æ¯”ï¼ˆæ¯”å¦‚"Vueçš„å“åº”å¼å°±åƒå¤©æ°”é¢„æŠ¥ï¼Œæ•°æ®ä¸€å˜ï¼Œç•Œé¢å°±è‡ªåŠ¨æ›´æ–°"ï¼‰
   - çœŸå®æ¡ˆä¾‹æˆ–ä½¿ç”¨åœºæ™¯
   - ç”ŸåŠ¨çš„æè¿°å’Œè§‚å¯Ÿ
   
   **é‡è¦**ï¼š
   - ä¸è¦è¿ç»­è¶…è¿‡3ä¸ªæ®µè½éƒ½æ˜¯çº¯æŠ€æœ¯è®²è§£ï¼Œå¿…é¡»åœ¨æŠ€æœ¯å†…å®¹ä¹‹é—´ç©¿æ’ç”ŸåŠ¨å†…å®¹ï¼
   - **ä¸è¦æ ‡æ³¨"ç”ŸåŠ¨ä¾‹å­"ã€"ä¿çš®è¯"ã€"å°æ•…äº‹"ç­‰æ ‡ç­¾**ï¼Œè¦è‡ªç„¶åœ°èå…¥å†…å®¹ä¸­ï¼Œè®©è¯»è€…æ„Ÿè§‰æ˜¯æ–‡ç« çš„è‡ªç„¶ç»„æˆéƒ¨åˆ†
   - é¿å…ä½¿ç”¨"å°æ•…äº‹"è¿™ç§å½¢å¼ï¼Œå› ä¸ºè¦ä¹ˆå¤ªé•¿æ˜¾å¾—çªå…€ï¼Œè¦ä¹ˆå¤ªçŸ­æ²¡æœ‰æ„ä¹‰
   - ç”ŸåŠ¨å…ƒç´ åº”è¯¥è‡ªç„¶åœ°å‡ºç°åœ¨æ®µè½ä¸­ï¼Œä¸è¦æœ‰æ˜æ˜¾çš„åˆ†éš”æˆ–æ ‡æ³¨

<<<<<<< HEAD
2. **è¯­è¨€é£æ ¼**ï¼ˆå¿…é¡»æ‰§è¡Œï¼Œè¿™æ˜¯ç¡¬æ€§è¦æ±‚ï¼ï¼‰ï¼š
   - **å¿…é¡»ä½¿ç”¨è½»æ¾çš„å£è¯­åŒ–è¡¨è¾¾**ï¼Œè®©æ–‡ç« è¯»èµ·æ¥åƒæœ‹å‹åœ¨èŠå¤©ï¼Œè€Œä¸æ˜¯å­¦æœ¯è®ºæ–‡
   - å¤§é‡ä½¿ç”¨å£è¯­åŒ–è¯æ±‡å’Œè¡¨è¾¾ï¼š
     * "ä½ "ã€"æˆ‘ä»¬"ã€"å…¶å®"ã€"è¯´ç™½äº†"ã€"è¯´ç™½äº†å°±æ˜¯"ã€"ä¸¾ä¸ªä¾‹å­"ã€"æƒ³è±¡ä¸€ä¸‹"
     * "å°±åƒ..."ã€"æ‰“ä¸ªæ¯”æ–¹..."ã€"è¿™å°±åƒ..."ã€"ä½ å¯ä»¥è¿™æ ·ç†è§£..."
     * "å—¯"ã€"å•Š"ã€"å‘¢"ã€"å§"ç­‰è¯­æ°”è¯ï¼ˆé€‚åº¦ä½¿ç”¨ï¼‰
     * "é‚£ä¹ˆ"ã€"ç„¶å"ã€"æ¥ä¸‹æ¥"ã€"ä¸è¿‡"ã€"ä½†æ˜¯"ç­‰è¿æ¥è¯
   - ä½¿ç”¨é€šä¿—æ˜“æ‡‚çš„è¯­è¨€ï¼Œé¿å…å †ç Œä¸“ä¸šæœ¯è¯­ï¼Œå¦‚æœå¿…é¡»ç”¨æœ¯è¯­ï¼Œç«‹å³ç”¨å£è¯­åŒ–æ–¹å¼è§£é‡Š
   - ä¿æŒè½»æ¾æ„‰å¿«çš„è¯­è°ƒï¼Œä¸è¦è¿‡äºä¸¥è‚ƒå’Œå­¦æœ¯åŒ–
   - é€‚å½“ä½¿ç”¨åé—®å¥ï¼š"æ˜¯ä¸æ˜¯ï¼Ÿ"ã€"å¯¹å§ï¼Ÿ"ã€"ä½ æƒ³æƒ³çœ‹..."
   - æ¯”å–»å’Œç±»æ¯”è¦è‡ªç„¶åœ°èå…¥æ®µè½ä¸­ï¼Œä¸è¦å•ç‹¬æˆæ®µæˆ–æ ‡æ³¨
   - **é‡è¦**ï¼šæ•´ç¯‡æ–‡ç« è‡³å°‘30%çš„å†…å®¹åº”è¯¥æ˜¯å£è¯­åŒ–è¡¨è¾¾ï¼Œä¸èƒ½å…¨æ˜¯æ­£å¼çš„æŠ€æœ¯æè¿°
=======
2. **è¯­è¨€é£æ ¼**ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰ï¼š
   - ä½¿ç”¨é€šä¿—æ˜“æ‡‚çš„è¯­è¨€ï¼Œé¿å…å †ç Œä¸“ä¸šæœ¯è¯­
   - è‡ªç„¶åœ°ç”¨"å°±åƒ..."ã€"æ‰“ä¸ªæ¯”æ–¹..."ã€"æƒ³è±¡ä¸€ä¸‹..."ç­‰å¼•å…¥ç”Ÿæ´»åŒ–ä¾‹å­ï¼Œä½†ä¸è¦åˆ»æ„æ ‡æ³¨
   - ä¿æŒè½»æ¾æ„‰å¿«çš„è¯­è°ƒï¼Œä¸è¦è¿‡äºä¸¥è‚ƒå’Œå­¦æœ¯åŒ–
   - é€‚å½“ä½¿ç”¨"ä½ "ã€"æˆ‘ä»¬"ç­‰äººç§°ï¼Œå¢åŠ äº²è¿‘æ„Ÿ
   - æ¯”å–»å’Œç±»æ¯”è¦è‡ªç„¶åœ°èå…¥æ®µè½ä¸­ï¼Œä¸è¦å•ç‹¬æˆæ®µæˆ–æ ‡æ³¨
>>>>>>> a21bf6770ed50ce1a0509f94c3a11bf91d2ff8f9

3. **ä¸¾ä¾‹è¦æ±‚**ï¼ˆæ¯ä¸ªé‡è¦æ¦‚å¿µéƒ½è¦æœ‰ï¼‰ï¼š
   - æŠ€æœ¯æ¦‚å¿µå¿…é¡»ç”¨ç”Ÿæ´»åŒ–çš„ä¾‹å­è§£é‡Šï¼Œä½†è¦è‡ªç„¶åœ°èå…¥æ®µè½ä¸­
   - æŠ½è±¡æ¦‚å¿µå¿…é¡»ç”¨å…·ä½“çš„åœºæ™¯æè¿°ï¼Œä¸è¦å•ç‹¬æ ‡æ³¨"ä¾‹å¦‚"ã€"æ¯”å¦‚"ç­‰
   - å¤æ‚æµç¨‹å¿…é¡»ç”¨ç®€å•çš„æ­¥éª¤è¯´æ˜
   - æ¯ä¸ªé‡è¦æ¦‚å¿µåï¼Œå¿…é¡»è‡ªç„¶åœ°è·Ÿä¸€ä¸ªç”ŸåŠ¨çš„ä¾‹å­æˆ–æ¯”å–»ï¼Œä¸è¦æœ‰æ˜æ˜¾çš„åˆ†éš”æˆ–æ ‡æ³¨
   - **é‡è¦**ï¼šç”ŸåŠ¨å…ƒç´ åº”è¯¥æ— ç¼èå…¥æ­£æ–‡ï¼Œè¯»è€…è¯»èµ·æ¥åº”è¯¥æ„Ÿè§‰æ˜¯æ–‡ç« çš„è‡ªç„¶ç»„æˆéƒ¨åˆ†ï¼Œè€Œä¸æ˜¯ç”Ÿç¡¬çš„æ’å…¥

4. **èŠ‚å¥æ§åˆ¶**ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰ï¼š
   - ä¸è¦è¿ç»­å¤šä¸ªæ®µè½éƒ½æ˜¯çº¯æŠ€æœ¯è®²è§£
   - åœ¨æŠ€æœ¯å†…å®¹ä¹‹é—´å¿…é¡»ç©¿æ’è½»æ¾çš„å†…å®¹ï¼Œä½†è¦è‡ªç„¶æµç•…
   - è®©è¯»è€…æœ‰"å–˜æ¯"çš„æœºä¼šï¼Œä¸ä¼šæ„Ÿåˆ°ç–²åŠ³
   - å¯ä»¥åœ¨é€‚å½“ä½ç½®è‡ªç„¶åœ°åŠ å…¥äº’åŠ¨æ€§è¯­å¥ï¼Œä½†ä¸è¦è¿‡åº¦ä½¿ç”¨

5. **è¶£å‘³æ€§è¦æ±‚**ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰ï¼š
   - é€‚å½“ä½¿ç”¨å¹½é»˜ã€æ¯”å–»ã€ç±»æ¯”ç­‰æ‰‹æ³•ï¼Œä½†è¦è‡ªç„¶èå…¥
   - è®©æŠ€æœ¯å†…å®¹ä¸å†æ¯ç‡¥ï¼Œä½†ä¸è¦ä¸ºäº†ç”ŸåŠ¨è€Œç”Ÿç¡¬æ’å…¥
   - å¯ä»¥è‡ªç„¶åœ°åŠ å…¥ä¸€äº›æœ‰è¶£çš„è§‚å¯Ÿæˆ–æ€è€ƒ
   - è®©è¯»è€…åœ¨é˜…è¯»è¿‡ç¨‹ä¸­æ„Ÿåˆ°æ„‰æ‚¦ï¼Œä½†ä¸è¦æœ‰æ˜æ˜¾çš„"æˆ‘åœ¨é€—ä½ ç¬‘"çš„æ„Ÿè§‰

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

**æ£€æŸ¥æ¸…å•**ï¼ˆç”Ÿæˆæ–‡ç« åè¯·è‡ªæ£€ï¼‰ï¼š
â–¡ æ˜¯å¦æ¯éš”2-3ä¸ªæ®µè½å°±æœ‰ç”ŸåŠ¨å…ƒç´ ï¼ˆè‡ªç„¶èå…¥ï¼Œæ— æ ‡æ³¨ï¼‰ï¼Ÿ
â–¡ æ˜¯å¦ä½¿ç”¨äº†ç”Ÿæ´»åŒ–çš„ä¾‹å­è§£é‡ŠæŠ€æœ¯æ¦‚å¿µï¼ˆè‡ªç„¶èå…¥æ®µè½ä¸­ï¼‰ï¼Ÿ
â–¡ è¯­è¨€æ˜¯å¦é€šä¿—æ˜“æ‡‚ï¼Œæ²¡æœ‰è¿‡åº¦å †ç Œæœ¯è¯­ï¼Ÿ
â–¡ æ˜¯å¦åœ¨æŠ€æœ¯å†…å®¹ä¹‹é—´ç©¿æ’äº†è½»æ¾çš„å†…å®¹ï¼ˆè‡ªç„¶æµç•…ï¼‰ï¼Ÿ
â–¡ æ˜¯å¦è®©è¯»è€…æ„Ÿåˆ°æœ‰è¶£å’Œæ˜“è¯»ï¼Ÿ
â–¡ **é‡è¦**ï¼šæ˜¯å¦é¿å…äº†"ç”ŸåŠ¨ä¾‹å­"ã€"ä¿çš®è¯"ã€"å°æ•…äº‹"ç­‰ç”Ÿç¡¬æ ‡ç­¾ï¼Ÿ
â–¡ **é‡è¦**ï¼šç”ŸåŠ¨å…ƒç´ æ˜¯å¦è‡ªç„¶åœ°èå…¥æ­£æ–‡ï¼Œæ²¡æœ‰æ˜æ˜¾çš„åˆ†éš”æˆ–æ ‡æ³¨ï¼Ÿ
<<<<<<< HEAD
â–¡ **å£è¯­åŒ–æ£€æŸ¥ï¼ˆå¿…é¡»æ»¡è¶³ï¼‰**ï¼š
  - æ˜¯å¦å¤§é‡ä½¿ç”¨äº†"ä½ "ã€"æˆ‘ä»¬"ã€"å…¶å®"ã€"è¯´ç™½äº†"ç­‰å£è¯­åŒ–è¯æ±‡ï¼Ÿ
  - æ˜¯å¦ä½¿ç”¨äº†"å°±åƒ..."ã€"æ‰“ä¸ªæ¯”æ–¹..."ã€"ä¸¾ä¸ªä¾‹å­"ç­‰å£è¯­åŒ–è¡¨è¾¾ï¼Ÿ
  - æ˜¯å¦ä½¿ç”¨äº†åé—®å¥ï¼ˆ"æ˜¯ä¸æ˜¯ï¼Ÿ"ã€"å¯¹å§ï¼Ÿ"ç­‰ï¼‰å¢åŠ äº’åŠ¨æ„Ÿï¼Ÿ
  - æ•´ç¯‡æ–‡ç« æ˜¯å¦è‡³å°‘æœ‰30%çš„å†…å®¹æ˜¯å£è¯­åŒ–è¡¨è¾¾ï¼Ÿ
  - è¯»èµ·æ¥æ˜¯å¦åƒæœ‹å‹åœ¨èŠå¤©ï¼Œè€Œä¸æ˜¯å­¦æœ¯è®ºæ–‡ï¼Ÿ
  - æ˜¯å¦é¿å…äº†è¿‡äºæ­£å¼å’Œå­¦æœ¯åŒ–çš„è¡¨è¾¾ï¼Ÿ

è®°ä½ï¼šä¸€ç¯‡å¥½çš„æŠ€æœ¯æ–‡ç« ï¼Œä¸ä»…è¦ä¸“ä¸šï¼Œæ›´è¦è®©è¯»è€…æ„¿æ„çœ‹å®Œã€‚ç”ŸåŠ¨æœ‰è¶£ã€è½»æ¾å£è¯­åŒ–çš„å†…å®¹èƒ½è®©å°ç™½ä¹Ÿèƒ½åšæŒè¯»åˆ°æœ€åï¼è¿™æ˜¯è¯„ä»·æ–‡ç« è´¨é‡çš„é‡è¦æ ‡å‡†ï¼
=======

è®°ä½ï¼šä¸€ç¯‡å¥½çš„æŠ€æœ¯æ–‡ç« ï¼Œä¸ä»…è¦ä¸“ä¸šï¼Œæ›´è¦è®©è¯»è€…æ„¿æ„çœ‹å®Œã€‚ç”ŸåŠ¨æœ‰è¶£çš„å†…å®¹èƒ½è®©å°ç™½ä¹Ÿèƒ½åšæŒè¯»åˆ°æœ€åï¼è¿™æ˜¯è¯„ä»·æ–‡ç« è´¨é‡çš„é‡è¦æ ‡å‡†ï¼
>>>>>>> a21bf6770ed50ce1a0509f94c3a11bf91d2ff8f9
"""
    
    # æ ¹æ®å­—æ•°è°ƒæ•´max_tokensï¼ˆé€šå¸¸1ä¸ªä¸­æ–‡å­—ç¬¦çº¦ç­‰äº1-2ä¸ªtokenï¼‰
    max_tokens = min(word_count * 2, 4000)  # é™åˆ¶æœ€å¤§tokenæ•°
    
    # è°ƒç”¨åƒé—®ç”Ÿæˆå†…å®¹
    result = client.generate(
        prompt=user_input,
        system_prompt=system_prompt,
        temperature=0.7,
        max_tokens=max_tokens
    )
    
    return result


def main():
    """
    åˆ›ä½œåŠŸèƒ½ä¸»å…¥å£
    """
    import argparse
    
    parser = argparse.ArgumentParser(description='TrendRadar åˆ›ä½œæ¨¡å—')
    parser.add_argument('--topic', type=str, help='æ–‡ç« ä¸»é¢˜ï¼ˆç›´æ¥ç”Ÿæˆæ–‡ç« æ¨¡å¼ï¼‰')
    parser.add_argument('--requirements', type=str, default='', help='å…·ä½“è¦æ±‚')
    parser.add_argument('--platform', type=str, default='é€šç”¨', help='ç›®æ ‡å¹³å°')
    parser.add_argument('--type', type=str, default='æŠ€æœ¯æ–‡ç« ', help='å†…å®¹ç±»å‹')
    parser.add_argument('--words', type=int, default=2000, help='ç›®æ ‡å­—æ•°')
    parser.add_argument('--style', type=str, default='ä¸“ä¸š', help='æ–‡ç« é£æ ¼')
    
    args = parser.parse_args()
    
    print("=" * 60)
    print("ğŸ“ TrendRadar åˆ›ä½œæ¨¡å—")
    print("=" * 60)
    
    client = get_qwen_client()
    if not client.enable:
        print("\nâš ï¸  è­¦å‘Šï¼šåƒé—®æ¨¡å‹æœªå¯ç”¨æˆ–API Keyæœªé…ç½®")
        print("è¯·åœ¨ config/config.yaml ä¸­é…ç½® ai.qwen.api_key")
        print("\n")
        return
    
    print("\nâœ… åƒé—®æ¨¡å‹å·²å°±ç»ª")
    print("\nåŠŸèƒ½è¯´æ˜ï¼š")
    print("  â€¢ åŸºäºçƒ­ç‚¹æ•°æ®ç”Ÿæˆåˆ›ä½œå†…å®¹")
    print("  â€¢ æ ¹æ®ä¸»é¢˜ç›´æ¥ç”Ÿæˆæ–‡ç« ")
    print("  â€¢ AI è¾…åŠ©æ–‡æœ¬ç”Ÿæˆï¼ˆä½¿ç”¨é€šä¹‰åƒé—®ï¼‰")
    print("  â€¢ å†…å®¹ä¼˜åŒ–å’Œç¼–è¾‘")
    print("  â€¢ å¤šæ ¼å¼å†…å®¹å¯¼å‡º")
    print("\n")
    
    # å¦‚æœæä¾›äº†ä¸»é¢˜ï¼Œåˆ™ç›´æ¥ç”Ÿæˆæ–‡ç« 
    if args.topic:
        print(f"æ­£åœ¨ç”Ÿæˆæ–‡ç« ï¼š{args.topic}")
        print("=" * 60)
        
        result = generate_article_by_topic(
            topic=args.topic,
            requirements=args.requirements,
            platform=args.platform,
            content_type=args.type,
            word_count=args.words,
            style=args.style
        )
        
        if result['success']:
            print("\nâœ… æ–‡ç« ç”ŸæˆæˆåŠŸï¼\n")
            print("=" * 60)
            print("ç”Ÿæˆçš„æ–‡ç« å†…å®¹ï¼š")
            print("=" * 60)
            print(result['content'])
            print("\n" + "=" * 60)
            
            # ä¿å­˜åˆ°æ–‡ä»¶
            output_dir = project_root / "output" / "articles"
            output_dir.mkdir(parents=True, exist_ok=True)
            
            from datetime import datetime
            filename = f"{datetime.now().strftime('%Y%m%d_%H%M%S')}_{args.topic[:20]}.md"
            output_path = output_dir / filename
            
            with open(output_path, 'w', encoding='utf-8') as f:
                f.write(f"# {args.topic}\n\n")
                f.write(f"**ç”Ÿæˆæ—¶é—´**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
                f.write(f"**å¹³å°**: {args.platform}\n\n")
                f.write(f"**ç±»å‹**: {args.type}\n\n")
                f.write("---\n\n")
                f.write(result['content'])
            
            print(f"\nğŸ“„ æ–‡ç« å·²ä¿å­˜åˆ°: {output_path}")
            
            if result.get('usage'):
                print(f"\nğŸ“Š Tokenä½¿ç”¨æƒ…å†µ: {result['usage']}")
        else:
            print(f"\nâŒ ç”Ÿæˆå¤±è´¥ï¼š{result.get('error', 'æœªçŸ¥é”™è¯¯')}")
    else:
        print("æç¤ºï¼šä½¿ç”¨ --topic å‚æ•°å¯ä»¥ç›´æ¥ç”Ÿæˆæ–‡ç« ")
        print("ç¤ºä¾‹ï¼špython create.py --topic 'Vue3ä¸Vue2å“åº”å¼åŒºåˆ«å’Œåº•å±‚åŸç†'")
        print("\n")


if __name__ == "__main__":
    main()

